üß≠ **Initiative (Issue)**
**–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ —Å—Ö–æ–¥—Å—Ç–≤–∞ –¥–ª—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤**

# TODO ‚Äî Semantic Graph (Postgres + Ingest + Embeddings + API)

–û–ø–∏—Å–∞–Ω–∏–µ:
–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä –∑–∞–¥–∞—á —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –≥—Ä–∞—Ñ–∞ –¥–ª—è publish‚Äë–ø–æ—Å—Ç–æ–≤:
1) –ë–î‚Äë—Å—Ö–µ–º–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏,
2) –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ publish‚Äë–ø–æ—Å—Ç–æ–≤ –∏–∑ SoT,
3) —Ä–∞—Å—á—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ similarity‚Äë–≥—Ä–∞—Ñ–∞,
4) API –¥–ª—è –≤—ã–¥–∞—á–∏ –≥—Ä–∞—Ñ–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ nodes + edges.
–°—á–∏—Ç–∞–µ–º –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π, –∫–æ–≥–¥–∞ –≤—Å–µ Sub‚ÄëIssue –∑–∞–∫—Ä—ã—Ç—ã –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–æ–±–ª—é–¥–µ–Ω—ã.

---

## Sub-Issue 1 ‚Äî DB migrations: pgvector + similarity_edges
–ö–æ—Ä–æ—Ç–∫–æ: –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Postgres‚Äë—Å—Ö–µ–º—É –¥–ª—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ undirected similarity‚Äëgraph.

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∑–∞–¥–∞—á–∞:
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å SQL‚Äë–º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è pgvector, similarity_edges –∏ embeddings.

–ß–µ–∫–±–æ–∫—Å—ã:
- [ ] –í–∫–ª—é—á–∏—Ç—å pgvector (CREATE EXTENSION IF NOT EXISTS vector).
- [ ] –°–æ–∑–¥–∞—Ç—å knowledge.similarity_edges —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –∏ CHECK (source_id < target_id).
- [ ] –î–æ–±–∞–≤–∏—Ç—å CHECK (weight –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0..1) –∏ UNIQUE (source_id, target_id, doc_type, method).
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã: source_id, target_id, weight DESC, (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) (doc_type, method).
- [ ] –î–æ–±–∞–≤–∏—Ç—å FK –Ω–∞ knowledge.documents(id) —Å ON DELETE CASCADE (–µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞/—Ç–∏–ø –ø–æ–¥—Ö–æ–¥—è—Ç), –∏–Ω–∞—á–µ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è FK.
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å knowledge.embeddings –¥–ª—è doc‚Äëlevel embeddings –±–µ–∑ –ª–æ–º–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
- [ ] –û–±–Ω–æ–≤–∏—Ç—å detai-core/workspace/db/README.md (pgvector, similarity_edges, undirected constraints).

---

## Sub-Issue 2 ‚Äî Ingest: Extract publish-posts from SoT
–ö–æ—Ä–æ—Ç–∫–æ: —Å–æ–±—Ä–∞—Ç—å publish‚Äë–ø–æ—Å—Ç—ã –∏–∑ SoT –≤ –≤–∏–¥–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∑–∞–¥–∞—á–∞:
–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å ingest‚Äë–º–æ–¥—É–ª—å –¥–ª—è —á—Ç–µ–Ω–∏—è publish‚Äë–ø–æ—Å—Ç–æ–≤ –∏–∑ SoT.

–ß–µ–∫–±–æ–∫—Å—ã:
- [ ] –ü—Ä–æ–π—Ç–∏ –ø–æ –ø—É—Ç—è–º SoT —Å –ø–æ—Å—Ç–∞–º–∏, —Å—á–∏—Ç–∞—Ç—å markdown‚Äë—Ñ–∞–π–ª—ã, –∏–∑–≤–ª–µ—á—å frontmatter –∏ body.
- [ ] –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ publish‚Äë–ø–æ—Å—Ç—ã (type == "post", administrative.status == "publish").
- [ ] –ü–æ—Å—Ç—Ä–æ–∏—Ç—å text_for_embedding (–æ—á–∏—Å—Ç–∫–∞ markdown, title + "\n\n" + body_text).
- [ ] –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –ø–æ—Å—Ç–∞ (id, title, authors, date_ymd, channels, taxonomy, text_for_embedding).

---

## Sub-Issue 3 ‚Äî Embeddings & Graph Builder
–ö–æ—Ä–æ—Ç–∫–æ: —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å Top‚ÄëK –≥—Ä–∞—Ñ —Å–≤—è–∑–µ–π.

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∑–∞–¥–∞—á–∞:
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á—ë—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ semantic graph.

–ß–µ–∫–±–æ–∫—Å—ã:
- [ ] –°–æ—Ö—Ä–∞–Ω–∏—Ç—å doc‚Äëembeddings –≤ knowledge.embeddings (upsert –ø–æ (doc_id, model), –±–µ–∑ —á–∞–Ω–∫–æ–≤).
- [ ] –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è pgvector (ivfflat –∏–ª–∏ hnsw) –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å top‚ÄëK –∑–∞–ø—Ä–æ—Å—ã.
- [ ] –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ min_similarity.
- [ ] –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä—ë–±–µ—Ä (source_id < target_id) –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ knowledge.similarity_edges —Å updated_at.
- [ ] –ò—Å–∫–ª—é—á–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã (UNIQUE –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ).

---

## Sub-Issue 4 ‚Äî API: Expose similarity graph endpoint
–ö–æ—Ä–æ—Ç–∫–æ: –æ—Ç–¥–∞—Ç—å publish‚Äë–≥—Ä–∞—Ñ —á–µ—Ä–µ–∑ API –≤ —Ñ–æ—Ä–º–∞—Ç–µ nodes + edges.

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∑–∞–¥–∞—á–∞:
–î–æ–±–∞–≤–∏—Ç—å API endpoint –¥–ª—è publish‚Äë–≥—Ä–∞—Ñ–∞.

–ß–µ–∫–±–æ–∫—Å—ã:
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å endpoint `/graph`, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π nodes –∏ edges.
- [ ] –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—ã–±–æ—Ä–∫—É publish‚Äë–ø–æ—Å—Ç–∞–º–∏ –∏ –≤–∞–ª–∏–¥–Ω—ã–º–∏ —Ä—ë–±—Ä–∞–º–∏.
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã: channel, year_from/year_to, rubric_id, category_id, limit_nodes.
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ JSON —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É –∏ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç—Å—è Next.js.
